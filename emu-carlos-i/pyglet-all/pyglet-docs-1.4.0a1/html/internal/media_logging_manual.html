<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Media logging manual &mdash; pyglet v1.4.0a1</title>
    
    <link rel="stylesheet" href="../_static/pyglet.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.4.0a1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="top" title="pyglet v1.4.0a1" href="../index.html" />
    <link rel="prev" title="Media manual" href="media_manual.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="media_manual.html" title="Media manual"
             accesskey="P">previous</a> |</li>
		<li><a href="http://pyglet.org/">pyglet.org</a> |</li>
		<li><a href="../index.html">Documentation Index</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="media-logging-manual">
<h1>Media logging manual<a class="headerlink" href="#media-logging-manual" title="Permalink to this headline">¶</a></h1>
<div class="section" id="workflows">
<h2>Workflows<a class="headerlink" href="#workflows" title="Permalink to this headline">¶</a></h2>
<div class="section" id="user-submitting-debug-info">
<h3>User submitting debug info<a class="headerlink" href="#user-submitting-debug-info" title="Permalink to this headline">¶</a></h3>
<p>Basically:</p>
<blockquote>
<div><ul class="simple">
<li>get samples</li>
<li>run a script</li>
<li>submit that directory</li>
</ul>
</div></blockquote>
<p>This is detailed in <code class="docutils literal"><span class="pre">tools/ffmpeg/readme_run_tests.txt</span></code>.</p>
</div>
<div class="section" id="changing-code-in-pyglet-ffmpeg-subsystem">
<h3>Changing code in pyglet ffmpeg subsystem<a class="headerlink" href="#changing-code-in-pyglet-ffmpeg-subsystem" title="Permalink to this headline">¶</a></h3>
<p>Preparation like in readme_run_tests.txt, optionally install the library bokeh
(<a class="reference external" href="http://bokeh.pydata.org/en/latest/index.html">http://bokeh.pydata.org/en/latest/index.html</a>) for visualization support.</p>
<p>The basic flow goes as:</p>
<ul>
<li><p class="first">initialize the active session subsystem:
set environment variable <code class="docutils literal"><span class="pre">pyglet_mp_samples_dir</span></code> to the desired
samples_dir.</p>
</li>
<li><p class="first">record a session with the initial state:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">configure</span><span class="o">.</span><span class="n">py</span> <span class="n">new</span> <span class="o">&lt;</span><span class="n">session</span><span class="o">&gt;</span> <span class="p">[</span><span class="n">playlist</span><span class="p">]</span>
<span class="n">run_test_suite</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
</li>
<li><p class="first">Follow this workflow</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>while True:
    edit code
    commit to hg
    record a new session:
        configure.py new &lt;new session&gt; [playlist]
        run_test_suite.py
    look at the last session reports in samples_dir/session/reports
    especially 00_summary.txt, which shows defects stats and list condensed
        info about any sample failing;
    then to look more details look at the individual reports.
    compare with prev sessions if desired:
        compare.py &lt;session1&gt; &lt;session2&gt;

    render additional reports:
        report.py sample

    or visualize the data collected with:
        bokeh_timeline.py sample

    if results are as wanted, break
done, you may want to delete sessions for intermediate commits
</pre></div>
</div>
</li>
</ul>
<p>It is possible to return to a previous session to request additional reports:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">configure</span><span class="o">.</span><span class="n">py</span> <span class="n">activate</span> <span class="o">&lt;</span><span class="n">session</span><span class="o">&gt;</span>
<span class="n">report</span><span class="o">.</span><span class="n">py</span> <span class="o">...</span>
</pre></div>
</div>
<p>You can list the known sessions for the current samples_dir with:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">configure</span><span class="o">.</span><span class="n">py</span> <span class="nb">list</span>
</pre></div>
</div>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p>All this debugging machinery depends on a detailed and accurate capture of
media_player related state, currently in examples/media_player.py and
pyglet.media.player.</p>
<p class="last">Modifications in those modules may require matching modifications in
pyglet/media/sources/instrumentation.py, and further propagation to other
modules.</p>
</div>
</div>
<div class="section" id="changing-the-debug-code-for-pyglet-ffmpeg">
<h3>Changing the debug code for pyglet ffmpeg<a class="headerlink" href="#changing-the-debug-code-for-pyglet-ffmpeg" title="Permalink to this headline">¶</a></h3>
<p>For initial debugging of debug code, where there are misspellings and trivial
errors to weed out, creating a new session for each run_test_suite.py run may
be inconvenient.</p>
<p>The flag <code class="docutils literal"><span class="pre">dev_debug</span></code> can be set to true in the session configuration file;
this will allow to rewrite the session.</p>
<p>Keep in mind that some raw data will be stale or misleading:</p>
<blockquote>
<div><ul class="simple">
<li>The ones captured at session creation time (currently pyglet.info and
pyglet_changeset)</li>
<li>The collected crashes info (new crashes will not be seen)</li>
<li>If media_player.py crashes before doing any writing, the state recording
will be the previous recording.</li>
</ul>
</div></blockquote>
<p>The reports using that stale raw data will obviously report stale data.</p>
<p>So it is a good idea to switch to a normal workflow as soon as posible
(simply creating a new session and deleting the special session).</p>
</div>
</div>
<div class="section" id="session">
<h2>Session<a class="headerlink" href="#session" title="Permalink to this headline">¶</a></h2>
<p>If <code class="docutils literal"><span class="pre">playlist_file</span></code> is not specified, then all files in samples_dir, except
for the files with extension “.dbg”, “.htm”, “.html”, “.json”, “.log”, “.pkl”,
“.py”, “.txt” will make the implicit playlist; subdirectories of samples_dir
will <strong>not</strong> be explored.</p>
<p>If a <code class="docutils literal"><span class="pre">playlist_file</span></code> is specified, then it should contain one sample name
per line; a sanity check will be performed ensuring no blacklisted extension
is used, and that the sample exists in samples_dir.</p>
<p>Once the <code class="docutils literal"><span class="pre">playlist_file</span></code> is used in <code class="docutils literal"><span class="pre">configure.py</span> <span class="pre">new</span></code> a copy is writen to
the session raw data directory, and this copy will be the authoritative
playlist for the session; <code class="docutils literal"><span class="pre">playlist_file</span></code> can be deleted if desired.</p>
<p>Specifying a playlist is useful in development to restrict the tests to
samples relevant to the feature or issue under work.</p>
<p>The session name will be used to create a samples_dir subdir to store the test
results, hence it should be different of previous sessions names, and it must
not contain slashes, <code class="docutils literal"><span class="pre">/</span></code>, backslashes <code class="docutils literal"><span class="pre">\</span></code> or characters forbidden in
directory names.</p>
</div>
<div class="section" id="active-session">
<h2>Active session<a class="headerlink" href="#active-session" title="Permalink to this headline">¶</a></h2>
<p>Most commands and subcommands target the currently active session.</p>
<p>A session becomes active when</p>
<blockquote>
<div><ul class="simple">
<li>a <code class="docutils literal"><span class="pre">configure.py</span> <span class="pre">new</span> <span class="pre">session</span> <span class="pre">[playlist]</span></code> is issued</li>
<li>a <code class="docutils literal"><span class="pre">configure.py</span> <span class="pre">activate</span> <span class="pre">session</span></code> is issued</li>
</ul>
</div></blockquote>
<p>The current implementation relies in two pieces of data to determine the
active session</p>
<blockquote>
<div><ul class="simple">
<li>the environment variable <code class="docutils literal"><span class="pre">pyglet_mp_samples_dir</span></code> specifies samples_dir,
the directory where all the media samples reside. Under the current
paths schema is also where session data will be stored, one subdir per
session.</li>
<li>a file <code class="docutils literal"><span class="pre">activation.json</span></code> in samples_dir storing the name for the
current active session.</li>
</ul>
</div></blockquote>
<p>Notice that the second precludes running two commands in parallel targeting
two different sessions in the same sample_dir.</p>
<p>The concept of active session plus the enforced path schema avoids the need to
provide paths at each command invocation, making for less errors, easier docs
and less typing.</p>
</div>
<div class="section" id="commands-summary">
<h2>Commands Summary<a class="headerlink" href="#commands-summary" title="Permalink to this headline">¶</a></h2>
<div class="section" id="primary-commands">
<h3>Primary commands<a class="headerlink" href="#primary-commands" title="Permalink to this headline">¶</a></h3>
<p>They are the ones normally used by developers</p>
<p><code class="docutils literal"><span class="pre">configure.py</span></code>, <code class="docutils literal"><span class="pre">mp.py</span></code> : session creation, activation, protection, status
and list all.</p>
<p><code class="docutils literal"><span class="pre">run_test_suite.py</span></code> : plays session’s samples, reports results.</p>
<p><code class="docutils literal"><span class="pre">report.py</span></code> : produces the specified report for the specified sample.</p>
<p><code class="docutils literal"><span class="pre">timeline.py</span></code> : translates the event stream to a stream of <code class="docutils literal"><span class="pre">media_player</span></code>
state, useful to pass to other software.</p>
<p><code class="docutils literal"><span class="pre">bokeh_timeline.py</span></code> : visualization of data collected for the specified
sample.</p>
</div>
<div class="section" id="helper-commands">
<h3>Helper commands<a class="headerlink" href="#helper-commands" title="Permalink to this headline">¶</a></h3>
<p>Somehow an artifact of <code class="docutils literal"><span class="pre">run_test_suite.py</span></code> development, can help in testing
the debugging subsystem. <code class="docutils literal"><span class="pre">run_test_suite.py</span></code> is basically <code class="docutils literal"><span class="pre">playmany.py</span> <span class="pre">+</span>
<span class="pre">retry_crashed.py</span> <span class="pre">+</span> <span class="pre">summarize.py</span></code>. When trying to change <code class="docutils literal"><span class="pre">run_test_suite.py</span></code>
it is easier to first adapt the relevant helper.</p>
<p><code class="docutils literal"><span class="pre">playmany.py</span></code> : plays active session samples, recording media_player state
along the play.</p>
<p><code class="docutils literal"><span class="pre">retry_crashed.py</span></code> : plays again samples that have been seen always
crashing, hoping to get a recording with no crash. Motivated by early tests on
Ubuntu, where sometimes (but not always) a sample will crash the media_player.</p>
<p><code class="docutils literal"><span class="pre">summarize.py</span></code> : using the raw data produced by the two previous commands
elaborates some reports, aiming to give an idea of how well the run was and
what samples should be investigated.</p>
</div>
</div>
<div class="section" id="data-directory-layout">
<h2>Data directory layout<a class="headerlink" href="#data-directory-layout" title="Permalink to this headline">¶</a></h2>
<div class="highlight-none"><div class="highlight"><pre><span></span>samples_dir/ : directory where the samples live, also used to store
               sessions data
    &lt;session name&gt;/ : directory to store session info, one per session,
                      named as the session.
        dbg/ : recording of media_player events captured while playing a
               sample, one per sample, named as sample.dbg; additional
               versioning info, other raw data collected.
            _crashes_light.pkl : pickle with info for retry crashed
            _pyglet_hg_revision.txt
            _pyglet_info.txt
            _samples_version.txt
            _session_playlist.txt
            &lt;one .dbg file per sample in the session playlist, named sample.dbg&gt;
        reports/ : human readable reports rendered from the raw data (.txt),
                   visualizations (.html), intermediate data used by other
                   tools(.pkl)
        configuration.json : session configuration info, mostly permissions
    activation.json : holds the name of current active session
    &lt;sample&gt; : one for each sample
</pre></div>
</div>
<p>A subdirectory of samples_dir is detected as a session dir if:</p>
<blockquote>
<div><ul class="simple">
<li>it is a direct child of session dir</li>
<li>it has a <code class="docutils literal"><span class="pre">configuration.json</span></code> file</li>
</ul>
</div></blockquote>
<p>policies:</p>
<blockquote>
<div><ul class="simple">
<li>it should be hard to rewrite the .dbg files (recordings of media_player
states)</li>
<li>think of dev analyzing data sent by an user.</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="code-layout-and-conventions">
<h2>Code Layout and conventions<a class="headerlink" href="#code-layout-and-conventions" title="Permalink to this headline">¶</a></h2>
<p>The emerging separation of responsabilities goes like</p>
<div class="section" id="scripts-commands">
<h3>Scripts (commands)<a class="headerlink" href="#scripts-commands" title="Permalink to this headline">¶</a></h3>
<p>Structured as:</p>
<blockquote>
<div><ul>
<li><p class="first">uses <code class="docutils literal"><span class="pre">if</span> <span class="pre">__main__</span></code> idiom to allow use as module (testing, sharing)</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">sysargs_to_mainargs()</span></code>: <code class="docutils literal"><span class="pre">sys.argv</span></code> translation to <code class="docutils literal"><span class="pre">main</span></code> params</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">main(...)</span></code></p>
<blockquote>
<div><ul class="simple">
<li>params validation and translation to adequate code entities (uses
module <code class="docutils literal"><span class="pre">fs</span></code>).</li>
<li>translates exceptions to prints (uses module <code class="docutils literal"><span class="pre">mpexceptions</span></code>)</li>
<li>short chain of instantiations / function calls to accomplish the
command goals, no logic or calculations here.</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">other functions and classes: code specific to this command, delegates as
much as possible to modules.</p>
</li>
</ul>
</div></blockquote>
<p>When two scripts use some related but not identical functionality, these parts
can be moved to another module. Example: at first <code class="docutils literal"><span class="pre">summarize</span></code> had the code to
collect defects stats, later, when <code class="docutils literal"><span class="pre">compare</span></code> was writen, the module
<code class="docutils literal"><span class="pre">extractors</span></code> was added and the defect collection stats code moved to that
module.</p>
<p>If script B needs a subset of unchanged script A functionality, it imports A
and uses what it needs. Example is <code class="docutils literal"><span class="pre">retry_crashed</span></code>, will call into
<code class="docutils literal"><span class="pre">playmany</span></code>.</p>
<p>Because of the last point, some scripts will also be listed as modules.</p>
</div>
<div class="section" id="modules">
<h3>Modules<a class="headerlink" href="#modules" title="Permalink to this headline">¶</a></h3>
<div class="section" id="buffered-logger">
<h4>buffered_logger<a class="headerlink" href="#buffered-logger" title="Permalink to this headline">¶</a></h4>
<p>Accumulation of debug events while playing media_player, saves when
sample’s play ends</p>
</div>
<div class="section" id="instrumentation">
<h4>instrumentation<a class="headerlink" href="#instrumentation" title="Permalink to this headline">¶</a></h4>
<p>Defines the events that modify media_player state.
Defines which events are potential defects.
Gives the low level support to extract info from the recorded data.</p>
<p>For new code here, keep accepting and returning only data structures, no paths
or files.</p>
</div>
<div class="section" id="fs">
<h4>fs<a class="headerlink" href="#fs" title="Permalink to this headline">¶</a></h4>
<p>Path building for entities into a session directory should be delegated to
<code class="docutils literal"><span class="pre">fs.PathServices</span></code>.
Session’s creation, activation and management at start of <code class="docutils literal"><span class="pre">fs</span></code>.
Versions capture are handled at start of module <code class="docutils literal"><span class="pre">fs</span></code>.
Utility functions to load - save at the end of <code class="docutils literal"><span class="pre">fs</span></code>.</p>
<p>While there isn’t a <code class="docutils literal"><span class="pre">Session</span></code> object, in practice the code identifies and
provides access to a particular session data by handling a <code class="docutils literal"><span class="pre">fs.PathServices</span></code>
instance.</p>
</div>
<div class="section" id="extractors">
<h4>extractors<a class="headerlink" href="#extractors" title="Permalink to this headline">¶</a></h4>
<p>Analyzes a media_player recording to build specific info on behalf of
reporters. Uses <code class="docutils literal"><span class="pre">instrumentation</span></code> to get input data about the media_player
state sequence seen while playing a sample.
Defines object types to collect some specific info about a replay.</p>
</div>
<div class="section" id="reports">
<h4>reports<a class="headerlink" href="#reports" title="Permalink to this headline">¶</a></h4>
<p>Formats as text info captured / generated elsewhere.</p>
</div>
<div class="section" id="mpexceptions">
<h4>mpexceptions<a class="headerlink" href="#mpexceptions" title="Permalink to this headline">¶</a></h4>
<p>Defines exceptions generated by code in the ffmpeg debug subsystem.</p>
</div>
</div>
<div class="section" id="scripts-that-also-acts-as-modules">
<h3>Scripts that also acts as modules<a class="headerlink" href="#scripts-that-also-acts-as-modules" title="Permalink to this headline">¶</a></h3>
<div class="section" id="timeline">
<h4>timeline<a class="headerlink" href="#timeline" title="Permalink to this headline">¶</a></h4>
<p>Renders the media player’s debug info to a format more suitable to postprocess
in a spreadsheets or other software, particularly to get a data visualization.
(used by <code class="docutils literal"><span class="pre">bokeh_timeline.py</span></code>)</p>
</div>
<div class="section" id="playmany">
<h4>playmany<a class="headerlink" href="#playmany" title="Permalink to this headline">¶</a></h4>
<p>Produces media_player debug recordings.
Runs python scripts as subprocesses with a timeout (used by retry_crashed.py).</p>
</div>
</div>
</div>
<div class="section" id="commands-detailed">
<h2>Commands detailed<a class="headerlink" href="#commands-detailed" title="Permalink to this headline">¶</a></h2>
<div class="section" id="bokeh-timeline-py">
<h3>bokeh_timeline.py<a class="headerlink" href="#bokeh-timeline-py" title="Permalink to this headline">¶</a></h3>
<p>Usage:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">bokeh_timeline</span><span class="o">.</span><span class="n">py</span> <span class="n">sample</span>
</pre></div>
</div>
<p>Renders media player’s internal state graphically using bokeh.</p>
<p>Arguments:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>sample: sample to report
</pre></div>
</div>
<p>The output will be written to session’s output dir under
<code class="docutils literal"><span class="pre">reports/sample.timeline.html</span></code>.</p>
<p>Notice the plot can be zoomed live with the mouse wheel, but you must click
the button that looks as a distorted <strong>OP</strong>; it also does pan with mouse drag.</p>
<p>Example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">bokeh_timeline</span><span class="o">.</span><span class="n">py</span> <span class="n">small</span><span class="o">.</span><span class="n">mp4</span>
</pre></div>
</div>
<p>will write the output to <code class="docutils literal"><span class="pre">report/small.mp4.timeline.html</span></code>.</p>
</div>
<div class="section" id="compare-py">
<h3>compare.py<a class="headerlink" href="#compare-py" title="Permalink to this headline">¶</a></h3>
<p>Usage:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">compare</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">reldir</span><span class="o">=</span><span class="n">relpath</span> <span class="n">other_session</span>
</pre></div>
</div>
<p>Builds a reports comparing the active session with other_session.</p>
<p>Outputs to <code class="docutils literal"><span class="pre">samples_dir/relpath/comparison_&lt;session&gt;_&lt;other_session&gt;.txt</span></code>.</p>
</div>
<div class="section" id="configure-py">
<h3>configure.py<a class="headerlink" href="#configure-py" title="Permalink to this headline">¶</a></h3>
<p>Usage:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">configure</span><span class="o">.</span><span class="n">py</span> <span class="n">subcommand</span> <span class="p">[</span><span class="n">args</span><span class="p">]</span>
</pre></div>
</div>
<p>Subcommands:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>new session [playlist] : Creates a new session, sets it as the active one
activate session : activates a session
deactivate : no session will be active
protect [target]: forbids overwrite of session data
status : prints configuration for the active session
help [subcommand] : prints help for the given subcommand or topic
list : list all sessions associated the current samples_dir
</pre></div>
</div>
<p>Creates and manages pyglet media_player debug session configurations.</p>
<p>Most commands and subcommands need an environment variable
<code class="docutils literal"><span class="pre">pyglet_mp_samples_dir</span></code> to be set to the directory where the media samples
reside.</p>
<p>The configuration stores some values used when other commands are executed,
mostly protection status.</p>
<p>This command can be called both as <code class="docutils literal"><span class="pre">configure.py</span></code> or <code class="docutils literal"><span class="pre">mp.py</span></code>, they do the
same.</p>
</div>
<div class="section" id="mp-py">
<h3>mp.py<a class="headerlink" href="#mp-py" title="Permalink to this headline">¶</a></h3>
<p>alias for <code class="docutils literal"><span class="pre">configure.py</span></code></p>
</div>
<div class="section" id="playmany-py">
<h3>playmany.py<a class="headerlink" href="#playmany-py" title="Permalink to this headline">¶</a></h3>
<p>Usage:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">playmany</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>Uses media_player to play a sequence of samples and record debug info.</p>
<p>A session must be active, see command <code class="docutils literal"><span class="pre">configure.py</span></code>
If the active configuration has disallowed dbg overwrites it will do nothing.</p>
<p>If a playlist was provided at session creation, then only the samples in the
playlist will be played, otherwise all files in <code class="docutils literal"><span class="pre">samples_dir</span></code>.</p>
</div>
<div class="section" id="report-py">
<h3>report.py<a class="headerlink" href="#report-py" title="Permalink to this headline">¶</a></h3>
<p>Usage:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">report</span><span class="o">.</span><span class="n">py</span> <span class="n">sample</span> <span class="n">report_name</span>
</pre></div>
</div>
<p>Generates a report from the debugging info recorded while playing sample.</p>
<p>Arguments:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>sample: sample to report
report_name: desired report, one of
    &quot;anomalies&quot;: Start, end and interesting events
    &quot;all&quot;: All data is exposed as text
    &quot;counter&quot;: How many occurrences of each defect
</pre></div>
</div>
<p>The report will be written to session’s output dir under
<code class="docutils literal"><span class="pre">reports/sample.report_name.txt</span></code>.</p>
<p>Example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">report</span> <span class="n">anomalies</span> <span class="n">small</span><span class="o">.</span><span class="n">mp4</span>
</pre></div>
</div>
<p>will write the report <em>anomalies</em> to <code class="docutils literal"><span class="pre">report/small.mp4.anomalies.txt</span></code>.</p>
<p>The authoritative list of reports available comes from
<code class="docutils literal"><span class="pre">reports.available_reports</span></code></p>
</div>
<div class="section" id="retry-crashed-py">
<h3>retry_crashed.py<a class="headerlink" href="#retry-crashed-py" title="Permalink to this headline">¶</a></h3>
<p>Usage:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">retry_crashed</span><span class="o">.</span><span class="n">py</span> <span class="p">[</span><span class="o">--</span><span class="n">clean</span><span class="p">]</span> <span class="p">[</span><span class="n">max_retries</span><span class="p">]</span>
</pre></div>
</div>
<p>Inspects the raw data collected to get the list of samples that crashed the
last time they were played.
Then it replays those samples, recording new raw data for them.</p>
<p>The process is repeated until all samples has a recording with no crashes or
the still crashing samples were played <code class="docutils literal"><span class="pre">max_tries</span></code> times in this command
run.</p>
<p>Notice that only samples recorded as crashing in the last run are retried.</p>
<p>A configuration must be active, see command <code class="docutils literal"><span class="pre">configure.py</span></code>.</p>
<p>Besides the updated debug recordings, a state is build and saved:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>total_retries: total retries attempted, including previous runs
sometimes_crashed: list of samples that crashed one time but later
                   completed a play
always_crashed: list of samples that always crashed
</pre></div>
</div>
<p>Options:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>--clean: discards crash data collected in a previous run
max_retries: defaults to 5
</pre></div>
</div>
</div>
<div class="section" id="run-test-suite-py">
<h3>run_test_suite.py<a class="headerlink" href="#run-test-suite-py" title="Permalink to this headline">¶</a></h3>
<p>Usage:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">run_test_suite</span><span class="o">.</span><span class="n">py</span> <span class="p">[</span><span class="n">samples_dir</span><span class="p">]</span>
</pre></div>
</div>
<p>Plays media samples with the pyglet media_player, recording debug information
for each sample played and writing reports about the data captured.</p>
<p>Arguments:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>samples_dir: directory with the media samples to play
</pre></div>
</div>
<p>If no samples_dir is provided the active session is the target.
If an explicit playlist was specified when creating the session, then only the
samples in the playlist will be played, otherwise all samples in samples_dir
will be played.</p>
<p>If sample_dir is provided, a session named <code class="docutils literal"><span class="pre">testrun_00</span></code> (<code class="docutils literal"><span class="pre">_01</span></code>, <code class="docutils literal"><span class="pre">_02</span></code>,
… if that name was taken) will be created, with no explicit playlist, and
then the command operates as in the previous case.</p>
<p>Output files will be into:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>samples_dir/session/dbg : binary capture of media_player events, other raw
                          data captured
samples_dir/session/reports : human readable reports
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This script will refuse to overwrite an existing <code class="docutils literal"><span class="pre">test_run</span> <span class="pre">results</span></code>.</p>
</div>
<p>Output files will be into subdirectories:</p>
<p><code class="docutils literal"><span class="pre">samples_dir/test_run/dbg</span></code></p>
<blockquote>
<div><p>Each sample will generate a <code class="docutils literal"><span class="pre">sample.dbg</span></code> file storing the sequence of
player debug events seen while playing the sample.
It is simply a pickle of a list of tuples, each tuple an event.
There are not meant for direct human use, but to run some analyzers to
render useful reports.</p>
<p>A <code class="docutils literal"><span class="pre">crash_retries.pkl</span></code> file, a pickle of
<code class="docutils literal"><span class="pre">(total_retries,</span> <span class="pre">sometimes_crashed,</span> <span class="pre">still_crashing)</span> <span class="pre">&lt;-&gt;</span> <span class="pre">(int,</span> <span class="pre">set,</span> <span class="pre">set)</span></code>.</p>
<p>A <code class="docutils literal"><span class="pre">pyglet.info</span></code> captured at session creation to track hw &amp; sw.</p>
<p>A pyglet hg revision captured at session creation.</p>
</div></blockquote>
<p><code class="docutils literal"><span class="pre">samples_dir/test_run/reports</span></code></p>
<blockquote>
<div><p>Human readable outputs, described in command <code class="docutils literal"><span class="pre">summarize.py</span></code></p>
<p>Later a user can generate visualizations and additional reports that will
be stored in this directory</p>
</div></blockquote>
</div>
<div class="section" id="summarize-py">
<h3>summarize.py<a class="headerlink" href="#summarize-py" title="Permalink to this headline">¶</a></h3>
<p>Usage:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">summarize</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>Summarizes the session info collected with <code class="docutils literal"><span class="pre">playmany</span></code> and <code class="docutils literal"><span class="pre">retry_crashes</span></code>.</p>
<p>A configuration must be active, see command <code class="docutils literal"><span class="pre">configure.py</span></code>.</p>
<p>If a playlist was provided at session creation, then only the samples in the
playlist will be played, otherwise all files in samples_dir.</p>
<p>Produces human readable reports, constructed from the .dbg files.</p>
<p>Output will be in</p>
<blockquote>
<div><code class="docutils literal"><span class="pre">samples_dir/test_run/reports</span></code></div></blockquote>
<p>The files in that directory will be</p>
<p><code class="docutils literal"><span class="pre">00_summary.txt</span></code> , which provides:</p>
<blockquote>
<div><ul class="simple">
<li>basics defects stats over all samples</li>
<li>a paragraph for each non perfect sample play with the count of each
anomaly observed</li>
</ul>
</div></blockquote>
<p><code class="docutils literal"><span class="pre">03_pyglet_info.txt</span></code> , <code class="docutils literal"><span class="pre">pyglet.info</span></code> output giving OS, python version,
etc (as captured at session creation).</p>
<p><code class="docutils literal"><span class="pre">04_pyglet_hg_revision.txt</span></code> , pyglet hg revision if running from a repo
clone, non writen if no repo (as captured at session creation).</p>
<p><code class="docutils literal"><span class="pre">sample_name.all.txt</span></code> and <code class="docutils literal"><span class="pre">sample_name.anomalies.txt</span></code> for each sample that
played non perfect.</p>
<p><code class="docutils literal"><span class="pre">sample_name.all.txt</span></code> has all info in the <code class="docutils literal"><span class="pre">sample_name.dbg</span></code> in human
readable form, that is, the sequence of player’s internal events along the
play.</p>
<p><code class="docutils literal"><span class="pre">sample_name.anomalies.txt</span></code> is a reduced version of the <code class="docutils literal"><span class="pre">.all</span></code>.
variant: normal events are not shown, only anomalies.</p>
</div>
<div class="section" id="timeline-py">
<h3>timeline.py<a class="headerlink" href="#timeline-py" title="Permalink to this headline">¶</a></h3>
<p>Usage:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">timeline</span><span class="o">.</span><span class="n">py</span> <span class="n">sample</span> <span class="p">[</span><span class="n">output_format</span><span class="p">]</span>
</pre></div>
</div>
<p>Renders the media player’s debug info to a format more suitable to postprocess
in a spreadsheets or other software, particularly to get a data visualization.</p>
<p>See output details in the manual.</p>
<p>Arguments:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>sample: sample to report
output_format : one of { &quot;csv&quot;, &quot;pkl&quot;}, by default saves as .pkl (pickle)
</pre></div>
</div>
<p>The output will be written to session’s output dir under
<code class="docutils literal"><span class="pre">reports/sample.timeline.[.pkl</span> <span class="pre">or</span> <span class="pre">.csv]</span></code>.</p>
<p>Example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">timeline</span><span class="o">.</span><span class="n">py</span> <span class="n">small</span><span class="o">.</span><span class="n">mp4</span>
</pre></div>
</div>
<p>will write the output to <code class="docutils literal"><span class="pre">report/small.mp4.timeline.pkl</span></code>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="docutils literal"><span class="pre">.csv</span></code> sample is currently not implemented.</p>
</div>
</div>
</div>
<div class="section" id="samples">
<h2>Samples<a class="headerlink" href="#samples" title="Permalink to this headline">¶</a></h2>
<p>Samples should be small, at the moment I suggest an arbitrary 2MB 2 minutes
limit. The samples dir contains a <code class="docutils literal"><span class="pre">_sources.txt</span></code> which lists from where
each sample comes.</p>
<p>Caveat:</p>
<blockquote>
<div><p>Samples are not ‘certified to be compliant with the specification’.</p>
<p>When possible, samples should be played with non ffmpeg software for
incidental confirmation of well formed</p>
<blockquote>
<div><p><code class="docutils literal"><span class="pre">*.mp4</span></code>, <code class="docutils literal"><span class="pre">*.3gp</span></code> played well with Windows Media Player for win7</p>
<p><code class="docutils literal"><span class="pre">*.ogv</span></code>, <code class="docutils literal"><span class="pre">*.</span> <span class="pre">webm</span></code> played well with Firefox 54.0</p>
<p><code class="docutils literal"><span class="pre">*.flv</span></code>, <code class="docutils literal"><span class="pre">*.mkv</span></code> played well with VLC Media player, but VLC uses
ffmpeg</p>
</div></blockquote>
</div></blockquote>
<p>Surely the samples set will be refined as time goes.</p>
</div>
<div class="section" id="pycharm-notes">
<h2>pycharm notes<a class="headerlink" href="#pycharm-notes" title="Permalink to this headline">¶</a></h2>
<p>For <code class="docutils literal"><span class="pre">examples/video_ffmpeg</span></code> module visibility and code completion, that
directory should be a ‘content root’ in pycharm settings | ‘project
structure’; as projects roots cannot nest, the pyglet working copy cannot be a
‘content root’, I removed it; I added also working_copy/pyglet as another
‘content root’ so pycharm plays well also en the library proper. This with
pycharm 2017.2</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/logo.png" alt="Logo"/>
            </a></p>
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Media logging manual</a><ul>
<li><a class="reference internal" href="#workflows">Workflows</a><ul>
<li><a class="reference internal" href="#user-submitting-debug-info">User submitting debug info</a></li>
<li><a class="reference internal" href="#changing-code-in-pyglet-ffmpeg-subsystem">Changing code in pyglet ffmpeg subsystem</a></li>
<li><a class="reference internal" href="#changing-the-debug-code-for-pyglet-ffmpeg">Changing the debug code for pyglet ffmpeg</a></li>
</ul>
</li>
<li><a class="reference internal" href="#session">Session</a></li>
<li><a class="reference internal" href="#active-session">Active session</a></li>
<li><a class="reference internal" href="#commands-summary">Commands Summary</a><ul>
<li><a class="reference internal" href="#primary-commands">Primary commands</a></li>
<li><a class="reference internal" href="#helper-commands">Helper commands</a></li>
</ul>
</li>
<li><a class="reference internal" href="#data-directory-layout">Data directory layout</a></li>
<li><a class="reference internal" href="#code-layout-and-conventions">Code Layout and conventions</a><ul>
<li><a class="reference internal" href="#scripts-commands">Scripts (commands)</a></li>
<li><a class="reference internal" href="#modules">Modules</a><ul>
<li><a class="reference internal" href="#buffered-logger">buffered_logger</a></li>
<li><a class="reference internal" href="#instrumentation">instrumentation</a></li>
<li><a class="reference internal" href="#fs">fs</a></li>
<li><a class="reference internal" href="#extractors">extractors</a></li>
<li><a class="reference internal" href="#reports">reports</a></li>
<li><a class="reference internal" href="#mpexceptions">mpexceptions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#scripts-that-also-acts-as-modules">Scripts that also acts as modules</a><ul>
<li><a class="reference internal" href="#timeline">timeline</a></li>
<li><a class="reference internal" href="#playmany">playmany</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#commands-detailed">Commands detailed</a><ul>
<li><a class="reference internal" href="#bokeh-timeline-py">bokeh_timeline.py</a></li>
<li><a class="reference internal" href="#compare-py">compare.py</a></li>
<li><a class="reference internal" href="#configure-py">configure.py</a></li>
<li><a class="reference internal" href="#mp-py">mp.py</a></li>
<li><a class="reference internal" href="#playmany-py">playmany.py</a></li>
<li><a class="reference internal" href="#report-py">report.py</a></li>
<li><a class="reference internal" href="#retry-crashed-py">retry_crashed.py</a></li>
<li><a class="reference internal" href="#run-test-suite-py">run_test_suite.py</a></li>
<li><a class="reference internal" href="#summarize-py">summarize.py</a></li>
<li><a class="reference internal" href="#timeline-py">timeline.py</a></li>
</ul>
</li>
<li><a class="reference internal" href="#samples">Samples</a></li>
<li><a class="reference internal" href="#pycharm-notes">pycharm notes</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="media_manual.html"
                        title="previous chapter">Media manual</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="media_manual.html" title="Media manual"
             >previous</a> |</li>
		<li><a href="http://pyglet.org/">pyglet.org</a> |</li>
		<li><a href="../index.html">Documentation Index</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2006-2017, Alex Holkner.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.6.5.
    </div>
  </body>
</html>